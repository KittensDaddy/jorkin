<script>
    function processMedia() {
        const fileInput = document.getElementById('media-file');
        const urlInput = document.getElementById('media-url');
        const previewImage = document.getElementById('preview');
        const errorMessage = document.getElementById('error-message');
        const saveButton = document.getElementById('save-btn');
        errorMessage.textContent = '';

        const formData = new FormData();
        let mediaFile = fileInput.files[0];
        let mediaUrl = urlInput.value;

        if (!mediaFile && !mediaUrl) {
            errorMessage.textContent = 'Please provide a file or a URL.';
            return;
        }

        if (mediaFile) {
            if (mediaFile.size > 10 * 1024 * 1024) {
                errorMessage.textContent = 'File size exceeds the 10MB limit.';
                return;
            }
            formData.append('media', mediaFile);
        } else {
            formData.append('url', mediaUrl);
        }

        // Send the request to the Vercel serverless function
        fetch('/api/process-media', {
            method: 'POST',
            body: formData
        })
        .then(response => response.blob())
        .then(blob => {
            const url = URL.createObjectURL(blob);
            previewImage.src = url;
            saveButton.style.display = 'block';
        })
        .catch(error => {
            errorMessage.textContent = 'Error: ' + error;
        });
    }
</script>
